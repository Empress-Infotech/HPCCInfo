<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-styles/color.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-label/iron-label.html">
<link rel="import" href="../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-combo-box.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="edit-interchart-interaction-dialog.html">
<dom-module id="list-interchart-interaction-dialog">
    <template>
        <style include="shared-dialog-styles">
            paper-dialog {
                width: 1400px;
            }

            #interactionslist {
                margin: 25px;
                height: auto;
                min-height: 300px;
                --iron-data-table-header: {
                    background-color: #e3e3e3;
                    font-size: 1.2em;
                    font-weight: 400;
                    border-bottom: 1px solid padding: 10px;
                }
            }

            .btn-link {
                padding: 2px 5px;
                background: #e6e6e6;
                border-radius: 3px;
                color: #666;
                font-weight: bold;
                font-size: 13px;
                width: 70px;
                margin: 0;
            }
        </style>
        <paper-dialog id="dialog" modal>
            <iron-label>
                <div class="headerDiv">
                    <span>
                      Interactions
                    </span>
                </div>
            </iron-label>
            <vaadin-grid id="interactionslist" active-item="{{activeItem}}">
                <vaadin-grid-column>
                    <template class="header">Interaction Chart Title</template>
                    <template>[[item.InteractionTitle]]</template>
                </vaadin-grid-column>
                <vaadin-grid-column>
                    <template class="header">Parent Chart</template>
                    <template>[[item.ParentChartTitle]]</template>
                </vaadin-grid-column>
                <vaadin-grid-column>
                    <template class="header">Parent Chart Input</template>
                    <template>[[item.FilteringField]]</template>
                </vaadin-grid-column>
                <vaadin-grid-column>
                    <template class="header"> Child Chart</template>
                    <template>[[item.ChildChartTitle]]</template>
                </vaadin-grid-column>
                <vaadin-grid-column>
                    <template class="header"> Child Chart Input</template>
                    <template>[[item.FilteringField]]</template>
                </vaadin-grid-column>
                <vaadin-grid-column>
                    <template class="header"> Edit</template>
                    <template>
                        <paper-button dialog-confirm on-tap="OpenEditInteractionPopup" class="btn-link">Edit</paper-button>
                    </template>
                </vaadin-grid-column>
                <vaadin-grid-column>
                    <template class="header"> Delete</template>
                    <template>
                        <paper-button dialog-confirm on-tap="DeleteInteractions" class="btn-link">Delete</paper-button>
                    </template>
                </vaadin-grid-column>
            </vaadin-grid>
            <div class="buttons">
                <paper-button dialog-dismiss raised class="green">Cancel</paper-button>
            </div>
        </paper-dialog>
        <paper-toast id="toast" class="fit-bottom"></paper-toast>
        <edit-interchart-interaction-dialog id="editinteractiondialog"></edit-interchart-interaction-dialog>
    </template>
    <script>
        class ListInterchartInteractionDialog extends Polymer.Element {
            static get is() { return 'list-interchart-interaction-dialog'; }
            static get properties() {
                return {
                    data: Array,
                    activeItem: {
                        observer: '_activeItemChanged'
                    }
                }
            }
            constructor() {
                super();
            }
            ready() {
                super.ready();              
            }
            _activeItemChanged(item) {
                this.$.interactionslist.selectedItems = item ? [item] : [];
            }
            open() {
                this.$.interactionslist.items = [];
                var infoBox = document.querySelector('my-app').shadowRoot.querySelector('hpcc-info-app').shadowRoot.querySelector('#infobox');
                var currentPage = infoBox.shadowRoot.querySelector('#pages').selectedItem;
                if (currentPage.editor != undefined) {
                    if (currentPage.editor.interactionDetails.length > 0) {
                        this.$.interactionslist.items = currentPage.editor.interactionDetails;
                        this.$.dialog.open();
                    }
                    else {
                        this.$.toast.text = "No Interaction Exists";
                        this.$.toast.open();
                    }
                }
                else {
                    this.$.toast.text = "No Interaction Exists";
                    this.$.toast.open();
                }
            }
            OpenEditInteractionPopup() {
                if (this.$.interactionslist.selectedItems[0] != null) {
                    var InteractionTitle = this.$.interactionslist.selectedItems[0].InteractionTitle;
                    var ParentChartTitle = this.$.interactionslist.selectedItems[0].ParentChartTitle;
                    var ChildChartTitle = this.$.interactionslist.selectedItems[0].ChildChartTitle;
                    var FilteringField = this.$.interactionslist.selectedItems[0].FilteringField;
                    var dialog = this.$.editinteractiondialog;
                    dialog.open(InteractionTitle);
                }
                else {
                    this.$.toast.text = "Please Select an Interaction";
                    this.$.toast.open();
                }
            }
            DeleteInteractions() {
                if (this.$.interactionslist.selectedItems[0] != null) {
                    var infoBox = document.querySelector('my-app').shadowRoot.querySelector('hpcc-info-app').shadowRoot.querySelector('#infobox');
                    var currentPage = infoBox.shadowRoot.querySelector('#pages').selectedItem;
                    var interactionTitle = this.$.interactionslist.selectedItems[0].InteractionTitle;
                    var index;
                    var ChildChartId;
                    for (var i = 0; i < currentPage.editor.interactionDetails.length; i++) {
                        var interactionchart = currentPage.editor.interactionDetails[i];
                        if (interactionchart.InteractionTitle == interactionTitle) {
                            ChildChartId = interactionchart.ChildChartId;
                            index = i;
                            break;
                        }
                    }
                    currentPage.editor.interactionDetails.splice(index, 1);
                    for (var i = 0; i < currentPage.editor.chartDetails.length; i++) {
                        var chart = currentPage.editor.chartDetails[i];
                        if (chart.ChartId === ChildChartId) {
                            chart.chartTitle = chart.chartTitle.replace(/ *\([^)]*\) */g, "");
                            initchart(infoBox.griddata, chart.chartTitle, chart.ChartType, chart.xcoordinate, chart.ycoordinate, chart.ChartId);
                        }
                    }
                    this.$.toast.text = "Interactions Deleted Successfully.";
                    this.$.toast.open();
                }

                else {
                    this.$.toast.text = "Please Select an Interaction";
                    this.$.toast.open();
                }
            }
        }
        customElements.define(ListInterchartInteractionDialog.is, ListInterchartInteractionDialog);
    </script>
</dom-module>